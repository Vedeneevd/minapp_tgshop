# Основные настройки MIME-типов должны быть в основном конфиге nginx.conf
# Но мы можем добавить их локально для этого сервера

server {
    listen 443 ssl;
    server_name rshop1.ru;

    ssl_certificate /etc/letsencrypt/live/rshop1.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/rshop1.ru/privkey.pem;

    # Явно указываем MIME-типы для этого сервера
    types {
        image/jpeg jpg jpeg;
        image/png png;
        image/gif gif;
        image/webp webp;
        text/css css;
        application/javascript js;
        text/html html htm;
    }

    # API
    location /api {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Frontend
    location / {
        root /var/www/rshop/frontend;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Статика
    location /static {
        alias /var/www/rshop/static;
        expires 30d;
        access_log off;

        # Особые правила для изображений
        location ~* \.(jpg|jpeg|png|gif|webp)$ {
            add_header Cache-Control "public, max-age=31536000";
            try_files $uri =404;

            # Явно указываем Content-Type
            types {
                image/jpeg jpg jpeg;
                image/png png;
                image/gif gif;
                image/webp webp;
            }
        }
    }
}